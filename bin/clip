#!/usr/bin/env bash
set -euo pipefail

if [[ -t 0 && $# -eq 0 ]]; then
  echo "Usage: ... | clip   OR   clip 'text to copy'" >&2
  exit 1
fi

copy_cmd=()

if command -v pbcopy >/dev/null 2>&1; then
  copy_cmd=(pbcopy)
elif command -v wl-copy >/dev/null 2>&1; then
  copy_cmd=(wl-copy)
elif command -v xclip >/dev/null 2>&1; then
  copy_cmd=(xclip -selection clipboard)
elif command -v xsel >/dev/null 2>&1; then
  copy_cmd=(xsel --clipboard --input)
else
  cat >&2 <<'ERR'
No clipboard command found.
Install one of:
  macOS: pbcopy (built-in)
  Linux Wayland: wl-copy (wl-clipboard)
  Linux X11: xclip or xsel
ERR
  exit 1
fi

if [[ $# -gt 0 && -t 0 ]]; then
  printf '%s' "$*" | "${copy_cmd[@]}"
else
  cat | "${copy_cmd[@]}"
fi
